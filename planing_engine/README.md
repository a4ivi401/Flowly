# Specification: Day Planning Algorithm Rules

**Version:** 1.0
**Status:** Approved
**Last Updated:** 2024

---

## 1. Overview (Мета)
Цей документ формалізує логіку, за якою система автоматично формує список задач на день ("Daily Plan"). Алгоритм має бути детермінованим до моменту втручання AI-оптимізатора.

## 2. Input Scope (Фільтрація задач)
З повного беклогу користувача в розрахунок беруться лише задачі, що відповідають наступним критеріям (`AND` логіка):

* **Status:** `TODO` або `IN_PROGRESS`.
* **Blocking:** Задача не має залежностей, які ще не виконані (`is_blocked = False`).
* **Start Date:** `Start Date` відсутня або `<=` поточній даті.
* **Exclusions:** Задачі з тегами `someday` або `on_hold` ігноруються в автоматичному режимі.

## 3. Ranking Strategy (Сортування)
Відфільтрований список сортується за спаданням важливості (Waterfall sort):

1.  **Overdue & Today Deadlines:** (Дедлайн < Завтра).
2.  **Priority:** `High` > `Medium` > `Low`.
3.  **Estimated Effort:** Від найкоротших до найдовших (Shortest Job First) — для максимізації кількості закритих тікетів (психологічний ефект).
4.  **Created At:** Старіші задачі вище (боротьба з "протуханням" задач).

## 4. Constraints (Ліміти)
Система використовує часові слоти (Time Boxing).

* **Total Daily Capacity:** 8 годин (480 хвилин).
* **Buffer:** 10% від часу (48 хвилин) резервується на перерви та форс-мажори.
* **Effective Planning Time:** $$480 - 48 = 432$$ хвилини.

## 5. Allocation Algorithm (Алгоритм наповнення)
Використовується жадібний алгоритм (Greedy Algorithm) з пропуском невідповідних елементів.

**Псевдокод логіки:**

1.  Отримати `Sorted_Candidates` згідно з пунктом 3.
2.  Встановити `Remaining_Time = 432` (хвилини).
3.  Створити порожній список `Daily_Plan`.
4.  Для кожної `Task` у `Sorted_Candidates`:
    * Якщо `Task.duration` не вказано, вважати `Default_Duration = 30 min`.
    * Перевірка:
        $$If\ (Task.duration \le Remaining\_Time):$$
        * Додати `Task` у `Daily_Plan`.
        * `Remaining_Time = Remaining_Time - Task.duration`
    * Інакше (задача не влазить):
        * Пропустити цю задачу (SKIP) і спробувати наступну (стратегія заповнення прогалин).
5.  Повернути `Daily_Plan`.

## 6. Edge Cases (Граничні випадки)

| Ситуація | Рішення системи |
| :--- | :--- |
| **Задача > 432 хв** | Задача додається в план, але генерується `Warning`: "Задача займає весь день". Решта задач залишаються в беклозі. |
| **Немає задач** | План порожній, виводиться повідомлення "All clear for today". |
| **Всі задачі Low Priority** | Планування відбувається стандартно до заповнення ліміту часу. |
| **Ручна зміна** | Якщо користувач вручну "пінить" (pinned) задачу, вона отримує найвищий пріоритет (0) і планується першою, ігноруючи сортування. |

---
